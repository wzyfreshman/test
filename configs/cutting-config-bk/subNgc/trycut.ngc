

(####################参数##################)
#<x1> = #3144
#<y1> = #3145
#<x2> = #3146
#<y2> = #3147
#<press> = #3149
#<angle> = #3151
#<probe_press> = #3052
#<zspeed> = #3153

(#####################下刀####################)
O001 if[#3150 EQ 1]

g53g90g01z[#5223-#3148]f#<zspeed>u#<press>
#3150=0

(#####################抬刀####################)
O001 else if[#3150 EQ 2]

g53g90g01z0f#<zspeed>u#<press>
#3150=0

(#####################试切####################)
O001 else if[#3150 EQ 3]

G53G01z0f400
G53G0A#<angle>
G53G0X#<x1>Y#<y1>
G53G1Z[#5223-#3148]F#<zspeed>u#<press>
G53G1X#<x2>Y#<y2>F4000u#<press>
G53G01z0f#<zspeed>
#3150=0

(####################零点检测##################)
O001 else if[#3150 EQ 4]


#4060=1

O016 if [#4082 EQ 1]
t1m6
O016 endif

#4010=0

m64 p0

G53G01z0f#<zspeed>

#1001=[#4009-#[5204+#5220*20]]


G53G90 G1 Z0 F#<zspeed>
G53G90 G1 Z[#4007] F[#4016]u#<probe_press>

m65 p0
G38.2 Z[#4009-#[5203+#5220*20]] F[#4008]u#<probe_press>

#1001=0
O101 repeat [#4001] 
G53G90 G1 Z[#5063+2] F[#4016]u0.05
G38.2 Z[#4009-#[5203+#5220*20]] F[#4008]u#<probe_press>
O112 if [#1001 eq 0]
#4014=#5063
#1001=[#1001+1]
O112 endif
#4010=[#4010+#5063]
O101 endrepeat 

O113 if [[#5063-#4014] GT #4015]
(debug,两次对刀的值大于对刀容差，请重新对刀)
M30
O113 endif
O114 if [[#5063-#4014] LT [0-#4015]]
(debug,两次对刀的值大于对刀容差，请重新对刀)
M30
O114 endif
#4011=[#4010/#4001]

(##########设置零点###########)
#[5203+#5220*20]=[#4011+#5103]
G10L2P[#5220]Z#[5203+#5220*20]

(debug,Z1第一次对刀值:#4011)
#4010=0
G53G90 G1 Z0 F#<zspeed>
O201 endif

G53G90 G1 Z0 F#<zspeed>
m65 p0

(N1015	自动对刀完成后，移动到固定点的标志)
O005 if [#4021 EQ 1]
G53G90G01Z0F#<zspeed>
G53G90G01Z[#4026]F#<zspeed>
O005 else if [#4021 EQ 2]

(Z1+Z2轴模式)
O014 if [#4000 EQ 2]
O030 if [#[5209+#5220*20] LT #[5204+#5220*20]]
#<MAXZ> = #[5209+#5220*20]
O030 else
#<MAXZ> = #[5204+#5220*20]
O030 endif

O015 if [#4029+#<MAXZ> LT 0]
G01Z[#4029]F[#4031]
O015 else
G53G90G01Z0F[#4031]
O015 endif
O014 endif


O010 if [#4000 NE 2]
O011 if [#4029+#[5203+#5220*20] LT 0]
G01Z[#4029]F[#4031]
O011 else
G53G90G01Z0F[#4031]
O011 endif
O010 endif

O005 endif

m30

#3150=0

(####################end##################)

O001 endif

